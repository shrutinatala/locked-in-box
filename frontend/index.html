<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>USC Libraries</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h1>USC Libraries</h1>
    <div id="libraries-container"></div>

    <script>
      const librariesContainer = document.getElementById("libraries-container");

      const LIBRARIES = [
        { name: "Leavey", id: "leavey", link: "leavey.html" },
        { name: "Doheny", id: "doheny", link: "#" },
        { name: "Hoose", id: "hoose", link: "#" },
      ];

      const MAX_OCCUPANCY = 100;
      let libraryData = {};
      LIBRARIES.forEach((lib) => (libraryData[lib.id] = 0));

      const gradientStops = [
        { pct: 0, color: "lightgreen" },
        { pct: 25, color: "#d9f542" },
        { pct: 50, color: "#f5d742" },
        { pct: 75, color: "#f59e42" },
        { pct: 100, color: "#f54242" },
      ];

      function lerpColor(a, b, t) {
        const ah = parseInt(a.replace(/#/g, ""), 16);
        const ar = ah >> 16,
          ag = (ah >> 8) & 0xff,
          ab = ah & 0xff;
        const bh = parseInt(b.replace(/#/g, ""), 16);
        const br = bh >> 16,
          bg = (bh >> 8) & 0xff,
          bb = bh & 0xff;
        const rr = ar + t * (br - ar),
          rg = ag + t * (bg - ag),
          rb = ab + t * (bb - ab);
        return (
          "#" +
          (
            (1 << 24) +
            (Math.round(rr) << 16) +
            (Math.round(rg) << 8) +
            Math.round(rb)
          )
            .toString(16)
            .slice(1)
        );
      }

      function getGradientColor(pct) {
        let lower = gradientStops[0],
          upper = gradientStops[gradientStops.length - 1];
        for (let i = 0; i < gradientStops.length - 1; i++) {
          if (pct >= gradientStops[i].pct && pct <= gradientStops[i + 1].pct) {
            lower = gradientStops[i];
            upper = gradientStops[i + 1];
            break;
          }
        }
        const range = upper.pct - lower.pct;
        const t = (pct - lower.pct) / range;
        return lerpColor(lower.color, upper.color, t);
      }

      function renderLibraries() {
        librariesContainer.innerHTML = "";
        LIBRARIES.forEach((lib) => {
          const pct = (libraryData[lib.id] / MAX_OCCUPANCY) * 100;
          const div = document.createElement("a");
          div.href = lib.link;
          div.classList.add("box");
          div.style.backgroundColor = "lightgreen";
          div.textContent = `${lib.name}\n${
            libraryData[lib.id]
          }/${MAX_OCCUPANCY}`;
          div.addEventListener("click", (e) => {
            if (lib.link === "#") {
              e.preventDefault();
              libraryData[lib.id] =
                (libraryData[lib.id] + 10) % (MAX_OCCUPANCY + 10);
              renderLibraries();
            }
          });
          librariesContainer.appendChild(div);
        });
      }

      renderLibraries();
    </script>
  </body>
</html>
