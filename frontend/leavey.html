<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Leavey Floors</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h1>Leavey Library Floors</h1>
    <div id="floors-container"></div>
    <p><a href="index.html">‚Üê Back to Libraries</a></p>

    <script>
      const floorsContainer = document.getElementById("floors-container");
      const FLOORS = [
        { name: "Basement", id: "basement", link: "leavey-basement.html" },
        { name: "1st Floor", id: "floor1", link: "#" },
        { name: "2nd Floor", id: "floor2", link: "#" },
        { name: "3rd Floor", id: "floor3", link: "#" },
      ];
      const MAX_OCCUPANCY = 50;
      let floorData = {};
      FLOORS.forEach((f) => (floorData[f.id] = 0));

      const gradientStops = [
        { pct: 0, color: "lightgreen" },
        { pct: 25, color: "#d9f542" },
        { pct: 50, color: "#f5d742" },
        { pct: 75, color: "#f59e42" },
        { pct: 100, color: "#f54242" },
      ];

      function lerpColor(a, b, t) {
        const ah = parseInt(a.replace(/#/g, ""), 16),
          ar = ah >> 16,
          ag = (ah >> 8) & 0xff,
          ab = ah & 0xff;
        const bh = parseInt(b.replace(/#/g, ""), 16),
          br = bh >> 16,
          bg = (bh >> 8) & 0xff,
          bb = bh & 0xff;
        const rr = ar + t * (br - ar),
          rg = ag + t * (bg - ag),
          rb = ab + t * (bb - ab);
        return (
          "#" +
          (
            (1 << 24) +
            (Math.round(rr) << 16) +
            (Math.round(rg) << 8) +
            Math.round(rb)
          )
            .toString(16)
            .slice(1)
        );
      }

      function getGradientColor(pct) {
        if (pct === 0) return "lightgreen"; // ensure 0 occupancy starts green
        let lower = gradientStops[0],
          upper = gradientStops[gradientStops.length - 1];
        for (let i = 0; i < gradientStops.length - 1; i++) {
          if (pct >= gradientStops[i].pct && pct <= gradientStops[i + 1].pct) {
            lower = gradientStops[i];
            upper = gradientStops[i + 1];
            break;
          }
        }
        const range = upper.pct - lower.pct;
        const t = (pct - lower.pct) / range;
        return lerpColor(lower.color, upper.color, t);
      }

      function renderFloors() {
        floorsContainer.innerHTML = "";
        FLOORS.forEach((f) => {
          const pct = (floorData[f.id] / MAX_OCCUPANCY) * 100;
          const div = document.createElement("a");
          div.href = f.link;
          div.classList.add("box");
          div.style.backgroundColor =
            pct === 0 ? "lightgreen" : getGradientColor(pct);
          div.style.color = "black"; // ensure text is visible
          div.textContent = `${f.name}\n${floorData[f.id]}/${MAX_OCCUPANCY}`;
          div.addEventListener("click", (e) => {
            if (f.link === "#") {
              e.preventDefault();
              floorData[f.id] = (floorData[f.id] + 5) % (MAX_OCCUPANCY + 5);
              renderFloors();
            }
          });
          floorsContainer.appendChild(div);
        });
      }

      renderFloors();
    </script>
  </body>
</html>
